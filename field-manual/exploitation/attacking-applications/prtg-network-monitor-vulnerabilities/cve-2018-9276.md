---
layout:
  width: default
  title:
    visible: true
  description:
    visible: false
  tableOfContents:
    visible: true
  outline:
    visible: true
  pagination:
    visible: false
  metadata:
    visible: true
---

# CVE-2018-9276

## Command Injection Vulnerability

An issue was discovered in PRTG Network Monitor **before** **18.2.39**.

An attacker who has access to the PRTG System Administrator web console with administrative privileges can exploit an OS command injection vulnerability (both on the server and on devices) by sending malformed parameters in sensor or notification management scenarios.

{% hint style="info" %}
## NIST NVD

[https://nvd.nist.gov/vuln/detail/CVE-2018-9276](https://nvd.nist.gov/vuln/detail/CVE-2018-9276)
{% endhint %}

{% hint style="info" %}
## Exploitation Write-up

[https://codewatch.org/2018/06/25/prtg-18-2-39-command-injection-vulnerability/](https://codewatch.org/2018/06/25/prtg-18-2-39-command-injection-vulnerability/)
{% endhint %}

## Exploitation

When creating a new notification, the `Parameter` field is passed directly into a PowerShell script without any type of input sanitization.

To begin, mouse over `Setup` in the top right and then the `Account Settings` menu and finally click on `Notifications`.

<figure><img src="../../../../.gitbook/assets/image (2) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

Next, click on `Add new notification`.

<figure><img src="../../../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

Give the notification a name and scroll down and tick the box next to `EXECUTE PROGRAM`. Under `Program File`, select `Demo exe notification - outfile.ps1` from the drop-down.

Finally, in the parameter field, enter a command. For our purposes, we will add a new local admin user by entering:

```
test.txt;net user prtgadm1 Pwn3d_by_PRTG! /add;net localgroup administrators prtgadm1 /add
```

During an actual assessment, we may want to do something that does not change the system, such as getting a reverse shell or connection to our C2.

Finally, click the `Save` button.

<figure><img src="../../../../.gitbook/assets/image (2) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

After clicking `Save`, we will be redirected to the `Notifications` page and see our new notification named `pwn` in the list.

<figure><img src="../../../../.gitbook/assets/image (3) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

{% hint style="info" %}
## Scheduled Execution

We could have scheduled the notification to run (and execute our command) at a later time when setting it up. This could prove handy as a persistence mechanism during a long-term engagement and is worth taking note of.

Schedules can be modified in the account settings menu if we want to set it up to run at a specific time every day to get our connection back or something of that nature.
{% endhint %}

At this point, all that is left is to click the `Test` button to run our notification and execute the command to add a local admin user. After clicking `Test` we will get a pop-up that says `EXE notification is queued up`. If we receive any sort of error message here, we can go back and double-check the notification settings.

Since this is a blind command execution, we won't get any feedback, so we'd have to either check our listener for a connection back or, in our case, check to see if we can authenticate to the host as a local admin.

We can use [crackmapexec.md](../../../../toolbox/tooling/post-exploitation/crackmapexec.md "mention") to confirm local admin access. We could also try to RDP to the box, access over WinRM, or use a tool such as [evil-winrm.md](../../../../toolbox/tooling/post-exploitation/evil-winrm.md "mention") or something from the [impacket](../../../../toolbox/tooling/post-exploitation/impacket/ "mention") toolkit such as `wmiexec.py` or `psexec.py`.

{% code title="Command" %}
```bash
sudo crackmapexec smb <IP> -u prtgadm1 -p Pwn3d_by_PRTG! 
```
{% endcode %}

{% code title="" %}
```
SMB         10.129.201.50   445    APP03            [*] Windows 10.0 Build 17763 (name:APP03) (domain:APP03) (signing:False) (SMBv1:False)
SMB         10.129.201.50   445    APP03            [+] APP03\prtgadm1:Pwn3d_by_PRTG! (Pwn3d!)
```
{% endcode %}
