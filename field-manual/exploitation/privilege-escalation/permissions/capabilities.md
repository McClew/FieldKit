---
layout:
  width: default
  title:
    visible: true
  description:
    visible: false
  tableOfContents:
    visible: true
  outline:
    visible: true
  pagination:
    visible: false
  metadata:
    visible: true
---

# Capabilities

Linux capabilities are a security feature in the Linux operating system that allows specific privileges to be granted to processes, allowing them to perform specific actions that would otherwise be restricted. This allows for more fine-grained control over which processes have access to certain privileges, making it more secure than the traditional Unix model of granting privileges to users and groups.

However, like any security feature, Linux capabilities are not invulnerable and can be exploited by attackers. One common vulnerability is using capabilities to grant privileges to processes that are not adequately sandboxed or isolated from other processes, allowing us to escalate their privileges and gain access to sensitive information or perform unauthorised actions.

Another potential vulnerability is the misuse or overuse of capabilities, which can result in processes having more privileges than they need. This can create unnecessary security risks, as we could exploit these privileges to gain access to sensitive information or perform unauthorised actions.

Overall, Linux capabilities can be a practical security feature, but they must be used carefully and correctly to avoid vulnerabilities and potential exploits.

Setting capabilities involves using the appropriate tools and commands to assign specific capabilities to executables or programs. In Ubuntu, for example, we can use the `setcap` command to set capabilities for specific executables. This command allows us to specify the capability we want to set and the value we want to assign.

For example, we could use the following command to set the `cap_net_bind_service` capability for an executable:

```bash
sudo setcap cap_net_bind_service=+ep /usr/bin/vim.basic
```

When capabilities are set for a binary, it means that the binary will be able to perform specific actions that it would not be able to perform without the capabilities. For example, if the `cap_net_bind_service` capability is set for a binary, the binary will be able to bind to network ports, which is a privilege usually restricted.

Some capabilities, such as `cap_sys_admin`, which allows an executable to perform actions with administrative privileges, can be dangerous if they are not used properly. For example, we could exploit them to escalate their privileges, gain access to sensitive information, or perform unauthorised actions. Therefore, it is crucial to set these types of capabilities for properly sandboxed and isolated executables and avoid granting them unnecessarily.

* cap\_sys\_admin: Allows performing actions with administrative privileges, such as modifying system files or changing system settings.
* cap\_sys\_chroot: Allows changing the root directory for the current process, enabling access to files and directories that would otherwise be inaccessible.
* cap\_sys\_ptrace: Allows attaching to and debugging other processes, potentially enabling access to sensitive information or modification of other processes' behaviour.
* cap\_sys\_nice: Allows raising or lowering the priority of processes, potentially enabling access to restricted resources.
* cap\_sys\_time: Allows modifying the system clock, potentially enabling the manipulation of timestamps or causing other processes to behave unexpectedly.
* cap\_sys\_resource: Allows modifying system resource limits, such as the maximum number of open file descriptors or the maximum amount of memory that can be allocated.
* cap\_sys\_module: Allows loading and unloading kernel modules, potentially enabling modification of the operating system's behaviour or gaining access to sensitive information.
* cap\_net\_bind\_service: Allows binding to network ports, potentially enabling access to sensitive information or performing unauthorised actions.

When a binary is executed with capabilities, it can perform the actions that the capabilities allow. However, it will not be able to perform any actions not allowed by the capabilities. This allows for more fine-grained control over the binary's privileges and can help prevent security vulnerabilities and unauthorised access to sensitive information.

When using the `setcap` command to set capabilities for an executable in Linux, we need to specify the capability we want to set and the value we want to assign. The values we use will depend on the specific capability we are setting and the privileges we want to grant to the executable.

Here are some examples of values that we can use with the `setcap` command, along with a brief description of what they do:

* `=` : Sets the specified capability for the executable, but does not grant any privileges. This is useful for clearing a previously set capability.
* `+ep` : Grants the effective and permitted privileges for the specified capability to the executable. This allows the executable to perform the actions the capability permits, but no actions that aren't allowed by the capability.
* `+ei`: Grants sufficient and inheritable privileges for the specified capability to the executable. This allows the executable to perform the actions the capability permits, and allows child processes spawned by the executable to inherit the capability and perform the same actions.
* `+p`: Grants the permitted privileges for the specified capability to the executable. This allows the executable to perform the actions the capability permits, but no actions that aren't allowed by the capability. This is useful for granting the capability while preventing it from being inherited or allowing child processes to inherit it.

Several Linux capabilities can be used to escalate a user's privileges to `root`, including:

* cap\_setuid: Allows a process to set its effective user ID. This can be used to gain the privileges of another user, including the root user.
* cap\_setgid: Allows a process to set its effective group ID. This can be used to gain the privileges of another group, including the root group.
* cap\_sys\_admin: Provides a broad range of administrative privileges. This includes the ability to perform many actions typically reserved for the root user, such as modifying system settings and mounting/unmounting file systems.
* cap\_dac\_override: Allows bypassing of file read, write, and execute permission checks (Discretionary Access Control).

## Enumeration

It is important to note that these capabilities should be used with caution and only granted to trusted processes, as they can be misused to gain unauthorised access to the system. To enumerate all existing capabilities for all existing binary executables on a Linux system, we can use the following command:

{% code title="Command" %}
```bash
find /usr/bin /usr/sbin /usr/local/bin /usr/local/sbin -type f -exec getcap {} \;
```
{% endcode %}

{% code title="Example Output" %}
```bash
/usr/bin/vim.basic cap_dac_override=eip
/usr/bin/ping cap_net_raw=ep
/usr/bin/mtr-packet cap_net_raw=ep
```
{% endcode %}

This one-liner uses the `find` command to search for all binary executables in the directories where they are typically located and then uses the `-exec` flag to run the `getcap` command on each, showing the capabilities that have been set for that binary. The output of this command will show a list of all binary executables on the system, along with the capabilities that have been set for each.

## Exploitation

If we gained access to the system with a low-privilege account, then discovered the `cap_dac_override` capability:

